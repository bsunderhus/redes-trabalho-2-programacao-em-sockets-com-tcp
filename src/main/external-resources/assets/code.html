<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Código do trabalho</title>
    <style>
        * {
            font-size:;
        }
        body {
            margin: 0;
        }
        pre {
            margin:0;
        }
    </style>
</head>
<body>
<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">package</span> <span style="color: #f8f8f2">br</span><span style="color: #f92672">.</span><span style="color: #a6e22e">inf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">ufes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">redes</span><span style="color: #f92672">;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.net.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.*</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">WebServer</span> <span style="color: #f92672">{</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">PORT</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">3000</span><span style="color: #f92672">;</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Método utilizado para processamento de conexão socket. Tem como objetivo verificar se a mensagem vindo pela conexão realmentre está no formato de uma mensagem do protocolo HTTP.</span>
<span style="color: #75715e">     * O método processa a primeira linha da mensagem para verificar se o método requerido pelo protocolo HTTP é GET ou HEAD, logo em seguida invoca funções para tratamento e envio de mensagem para os casos de GET, HEAd e de Bad Requests.</span>
<span style="color: #75715e">     * @param connectionSocket conexão Socket a ser verificada e respondida</span>
<span style="color: #75715e">     * @throws IOException lança exceção caso algum arquivo inexistente tente ser processado ou caso falhe na escrita da Stream de retorno do Socket</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">respondSocket</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Socket</span> <span style="color: #f8f8f2">connectionSocket</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span><span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Starting to process request...&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">BufferedReader</span> <span style="color: #f8f8f2">inFromClient</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">BufferedReader</span><span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">InputStreamReader</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">connectionSocket</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getInputStream</span><span style="color: #f92672">()));</span>
        <span style="color: #f8f8f2">DataOutputStream</span> <span style="color: #f8f8f2">outToClient</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DataOutputStream</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">connectionSocket</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getOutputStream</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">firstLine</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inFromClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">readLine</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">firstLine</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">return</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">StringTokenizer</span> <span style="color: #f8f8f2">tokenizedLine</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">StringTokenizer</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">firstLine</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">method</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tokenizedLine</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextToken</span><span style="color: #f92672">().</span><span style="color: #a6e22e">toUpperCase</span><span style="color: #f92672">();</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">path</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tokenizedLine</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextToken</span><span style="color: #f92672">();</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">protocol</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tokenizedLine</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextToken</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(!</span><span style="color: #f8f8f2">protocol</span><span style="color: #f92672">.</span><span style="color: #a6e22e">startsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HTTP&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Not an HTTP Request&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">connectionSocket</span><span style="color: #f92672">.</span><span style="color: #a6e22e">close</span><span style="color: #f92672">();</span>
            <span style="color: #66d9ef">return</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">protocol</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">method</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; Request:&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">firstLine</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">restOfLines</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">while</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">restOfLines</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inFromClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">readLine</span><span style="color: #f92672">()).</span><span style="color: #a6e22e">length</span><span style="color: #f92672">()</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">restOfLines</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">equals</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;GET&quot;</span><span style="color: #f92672">))</span> <span style="color: #f8f8f2">writeMessage</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">else</span> <span style="color: #a6e22e">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">method</span><span style="color: #f92672">.</span><span style="color: #a6e22e">equals</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HEAD&quot;</span><span style="color: #f92672">))</span> <span style="color: #f8f8f2">writeMessage</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">else</span> <span style="color: #a6e22e">writeBadRequest</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">connectionSocket</span><span style="color: #f92672">.</span><span style="color: #a6e22e">close</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Método utilizado para escrever a mensagem de retorono para a conexão socket.</span>
<span style="color: #75715e">     * Responsável por escrever o cabeçalho e o corpo da mensagem, gerando erro de arquivo não encontrado caso tente acessar um arquivo inexistente.</span>
<span style="color: #75715e">     * @param fileName Nome do arquivo desejado</span>
<span style="color: #75715e">     * @param outToClient Stream de resposta ao cliente</span>
<span style="color: #75715e">     * @param isHead booleano declarando se a mensagem é GET ou HEAD</span>
<span style="color: #75715e">     * @throws IOException lança exceção caso algum arquivo inexistente tente ser processado.</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">writeMessage</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">fileName</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DataOutputStream</span> <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">boolean</span> <span style="color: #f8f8f2">isHead</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">startsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/&quot;</span><span style="color: #f92672">))</span> <span style="color: #f8f8f2">fileName</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">substring</span><span style="color: #f92672">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span><span style="color: #f92672">()</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">fileName</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;index.html&quot;</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">isHead</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HTTP/1.0 HEAD Response:&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HTTP/1.0 GET Response:&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">try</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">WebServer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getResource</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fileName</span><span style="color: #f92672">).</span><span style="color: #a6e22e">getPath</span><span style="color: #f92672">());</span>
            <span style="color: #f8f8f2">InputStream</span> <span style="color: #f8f8f2">fileInputStream</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">WebServer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getResourceAsStream</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;/&quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fileName</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">read</span><span style="color: #f92672">;</span>
            <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">buffer</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[</span><span style="color: #ae81ff">1024</span><span style="color: #f92672">];</span>
            <span style="color: #f8f8f2">ByteArrayOutputStream</span> <span style="color: #f8f8f2">outputStream</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ByteArrayOutputStream</span><span style="color: #f92672">();</span>
            <span style="color: #66d9ef">while</span> <span style="color: #f92672">((</span><span style="color: #f8f8f2">read</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fileInputStream</span><span style="color: #f92672">.</span><span style="color: #a6e22e">read</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">buffer</span><span style="color: #f92672">))</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">outputStream</span><span style="color: #f92672">.</span><span style="color: #a6e22e">write</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">buffer</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">read</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">bytes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">outputStream</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toByteArray</span><span style="color: #f92672">();</span>

            <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;HTTP/1.0 200 Document Follows\r\n&quot;</span><span style="color: #f92672">;</span>
            <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;html&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: text/html\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;js&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: application/javascript\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;css&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: text/css\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;woff2&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: font/woff2\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;jpg&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: image/jpeg\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;png&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: image/png\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;gif&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: image/gif\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">fileName</span><span style="color: #f92672">.</span><span style="color: #a6e22e">endsWith</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;txt&quot;</span><span style="color: #f92672">))</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;Content-Type: text/plain\r\n&quot;</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  Content-length: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">bytes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Content-length: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">bytes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  \r\n&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(!</span><span style="color: #f8f8f2">isHead</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">write</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">bytes</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">bytes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">length</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span> <span style="color: #66d9ef">catch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Exception</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">e</span> <span style="color: #66d9ef">instanceof</span> <span style="color: #f8f8f2">NullPointerException</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;FileName: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">fileName</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">e</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printStackTrace</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;HTTP/1.0 404 Not Found\r\n&quot;</span><span style="color: #f92672">;</span>
            <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">output</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  \r\n&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Método utilizado para escrever a mensagem de Bad Request para a conexão socket.</span>
<span style="color: #75715e">     * @param outToClient Stream de saída da mensagem para o Socket</span>
<span style="color: #75715e">     * @throws IOException lança exceçao caso falhe ao escrever na stream do Socket</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">writeBadRequest</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">DataOutputStream</span> <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span>  <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HTTP/1.0 Bad Request Response:&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  HTTP/1.0 400 Bad Request\r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;HTTP/1.0 400 Bad Request\r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  Content-length: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">0</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Content-length: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">0</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">print</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;  \r\n&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">outToClient</span><span style="color: #f92672">.</span><span style="color: #a6e22e">writeBytes</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;\r\n&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>

    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">main</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">args</span><span style="color: #f92672">[])</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">ServerSocket</span> <span style="color: #f8f8f2">listenSocket</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ServerSocket</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PORT</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Web server listening to port 3000...&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">aux</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">true</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">Socket</span> <span style="color: #f8f8f2">socket</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">listenSocket</span><span style="color: #f92672">.</span><span style="color: #a6e22e">accept</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Creating Thread to attend request&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">RespondThread</span> <span style="color: #f8f8f2">currentThread</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RespondThread</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">socket</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">aux</span><span style="color: #f92672">++);</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Thread &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">currentThread</span><span style="color: #f92672">.</span><span style="color: #a6e22e">id</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; created successfully&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">currentThread</span><span style="color: #f92672">.</span><span style="color: #a6e22e">start</span><span style="color: #f92672">();</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>

    <span style="color: #75715e">/**</span>
<span style="color: #75715e">     * Thread utilizada para processamento de mensagens em um socket</span>
<span style="color: #75715e">     */</span>
    <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">RespondThread</span> <span style="color: #66d9ef">extends</span> <span style="color: #f8f8f2">Thread</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">Socket</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">id</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">public</span> <span style="color: #a6e22e">RespondThread</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Socket</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">id</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">socket</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">;</span>
            <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">id</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>
        <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">run</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Starting Thread &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">id</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">try</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">WebServer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">respondSocket</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">socket</span><span style="color: #f92672">);</span>
            <span style="color: #f92672">}</span> <span style="color: #66d9ef">catch</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Exception</span> <span style="color: #f8f8f2">e</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
                <span style="color: #f8f8f2">e</span><span style="color: #f92672">.</span><span style="color: #a6e22e">printStackTrace</span><span style="color: #f92672">();</span>
            <span style="color: #f92672">}</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Stopping Thread &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">id</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

</body>
</html>